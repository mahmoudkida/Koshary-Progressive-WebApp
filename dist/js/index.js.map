{"version":3,"sources":["swhelper.js","dbhelper.js","index.js"],"names":["IndexController","this","_registerServiceWorker","prototype","navigator","serviceWorker","refreshing","indexController","register","then","reg","controller","waiting","_updateReady","installing","_trackInstalling","addEventListener","window","location","reload","worker","state","confirm","postMessage","action","swController","DBHelper","idb","open","upgradeDb","createObjectStore","keyPath","createIndex","Promise","resolve","callback","fetch","DATABASE_URL","response","json","restaurants","openDatabase","db","store","transaction","objectStore","forEach","restaurant","put","catch","ex","index","getAll","id","fetchRestaurants","error","find","r","cuisine","results","filter","cuisine_type","neighborhood","neighborhoods","map","v","i","uniqueNeighborhoods","indexOf","cuisines","uniqueCuisines","photograph","google","maps","Marker","position","latlng","title","name","url","urlForRestaurant","animation","Animation","DROP","document","event","getAllRestaurants","fetchNeighborhoods","console","fillNeighborhoodsHTML","arguments","length","undefined","self","select","getElementById","option","fetchCuisines","fillCuisinesHTML","createElement","innerHTML","value","append","initMap","Map","zoom","center","lat","lng","scrollwheel","add","addMarkersToMap","initStaticMap","imageConrtainer","staticMapURL","offsetWidth","offsetHeight","querySelector","setAttribute","fetchRestaurantByCuisineAndNeighborhood","resetRestaurants","fillRestaurantsHTML","updateRestaurants","cSelect","selectedIndex","nSelect","markers","m","setMap","ul","createRestaurantHTML","setTimeout","bLazy","revalidate","li","imageSrc","imageUrlForRestaurant","image","className","src","picture","dataContainer","href","address","more","classList","addListener","marker","push","changeAriaValue","that","getAttribute"],"mappings":"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","file":"index.js","sourcesContent":["\r\n\r\nfunction IndexController() {\r\n  this._registerServiceWorker();\r\n}\r\n\r\nIndexController.prototype._registerServiceWorker = function() {\r\n  if (!navigator.serviceWorker) return;\r\n\r\n  var indexController = this;\r\n\r\n  navigator.serviceWorker.register('sw.js').then(function(reg) {\r\n    if (!navigator.serviceWorker.controller) {\r\n      return;\r\n    }\r\n\r\n    if (reg.waiting) {\r\n      indexController._updateReady(reg.waiting);\r\n      return;\r\n    }\r\n\r\n    if (reg.installing) {\r\n      indexController._trackInstalling(reg.installing);\r\n      return;\r\n    }\r\n\r\n    reg.addEventListener('updatefound', function() {\r\n      indexController._trackInstalling(reg.installing);\r\n    });\r\n  });\r\n\r\n  // Ensure refresh is only called once.\r\n  // This works around a bug in \"force update on reload\".\r\n  var refreshing;\r\n  navigator.serviceWorker.addEventListener('controllerchange', function() {\r\n    if (refreshing) return;\r\n    window.location.reload();\r\n    refreshing = true;\r\n  });\r\n};\r\n\r\nIndexController.prototype._trackInstalling = function(worker) {\r\n  var indexController = this;\r\n  worker.addEventListener('statechange', function() {\r\n    if (worker.state == 'installed') {\r\n      indexController._updateReady(worker);\r\n    }\r\n  });\r\n};\r\n\r\nIndexController.prototype._updateReady = function(worker) {\r\n\r\n    var toast = confirm(\"New version available, do you want to upate ?\");\n\r\nif (toast != null) {\r\n    worker.postMessage({action: 'skipWaiting'});\r\n}\r\n\r\n};\r\n\r\n//initialize sw\r\nconst swController = new IndexController();\r\n","/**\r\n * Common database helper functions.\r\n */\r\nclass DBHelper {\r\n\r\n\r\n    static openDatabase() {\r\n        // If the browser doesn't support service worker,\r\n        // we don't care about having a database\r\n        if (!navigator.serviceWorker) {\r\n            return Promise.resolve();\r\n        }\r\n\r\n        return idb.open('koshary', 1, function (upgradeDb) {\r\n            var store = upgradeDb.createObjectStore('restaurants', {\r\n                keyPath: 'id'\r\n            });\r\n            store.createIndex('id', 'id');\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Database URL.\r\n     * Change this to restaurants.json file location on your server.\r\n     */\r\n    static get DATABASE_URL() {\r\n        //const port = location.port ? location.port : 8000 // Change this to your server port\r\n        const port = 1337; //change according to gulpfile config\r\n        //const host = location.hostname ? location.hostname : 'localhost';\r\n        const host = 'localhost';\r\n        return `http://${host}:${port}/restaurants`;\r\n    }\r\n\r\n    /**\r\n     * Fetch all restaurants.\r\n     */\r\n    static fetchRestaurants(callback) {\r\n        fetch(DBHelper.DATABASE_URL).then((response) => {\r\n            return response.json();\r\n        }).then((json) => {\r\n\r\n            //add restuarants object array into a variable\r\n            const restaurants = json;\r\n            //open indexdb to cach all restaurants data\r\n            DBHelper.openDatabase().then( (db) => {\r\n                if (!db) return;\r\n                let tx = db.transaction('restaurants', 'readwrite');\r\n                let store = tx.objectStore('restaurants');\r\n                restaurants.forEach(function (restaurant) {\r\n                    store.put(restaurant);\r\n                });\r\n            });\r\n            callback(null, restaurants);\r\n\r\n        }).catch((ex) => {\r\n            const error = (`Request failed. Returned status of ${ex}`);\r\n            DBHelper.openDatabase().then( (db) => {\r\n                if (!db) return;\r\n                let tx = db.transaction('restaurants', 'readwrite');\r\n                let store = tx.objectStore('restaurants');\r\n                let idIndex = store.index(\"id\");\r\n                return idIndex.getAll();\r\n            }).then((json)=>{\r\n                const restaurants = json;\r\n                callback(null, restaurants);\r\n            });\r\n\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Fetch a restaurant by its ID.\r\n     */\r\n    static fetchRestaurantById(id, callback) {\r\n        // fetch all restaurants with proper error handling.\r\n        DBHelper.fetchRestaurants((error, restaurants) => {\r\n            if (error) {\r\n                callback(error, null);\r\n            } else {\r\n                const restaurant = restaurants.find(r => r.id == id);\r\n                if (restaurant) { // Got the restaurant\r\n                    callback(null, restaurant);\r\n                } else { // Restaurant does not exist in the database\r\n                    callback('Restaurant does not exist', null);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Fetch restaurants by a cuisine type with proper error handling.\r\n     */\r\n    static fetchRestaurantByCuisine(cuisine, callback) {\r\n        // Fetch all restaurants  with proper error handling\r\n        DBHelper.fetchRestaurants((error, restaurants) => {\r\n            if (error) {\r\n                callback(error, null);\r\n            } else {\r\n                // Filter restaurants to have only given cuisine type\r\n                const results = restaurants.filter(r => r.cuisine_type == cuisine);\r\n                callback(null, results);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Fetch restaurants by a neighborhood with proper error handling.\r\n     */\r\n    static fetchRestaurantByNeighborhood(neighborhood, callback) {\r\n        // Fetch all restaurants\r\n        DBHelper.fetchRestaurants((error, restaurants) => {\r\n            if (error) {\r\n                callback(error, null);\r\n            } else {\r\n                // Filter restaurants to have only given neighborhood\r\n                const results = restaurants.filter(r => r.neighborhood == neighborhood);\r\n                callback(null, results);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Fetch restaurants by a cuisine and a neighborhood with proper error handling.\r\n     */\r\n    static fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood, callback) {\r\n        // Fetch all restaurants\r\n        DBHelper.fetchRestaurants((error, restaurants) => {\r\n            if (error) {\r\n                callback(error, null);\r\n            } else {\r\n                let results = restaurants\r\n                if (cuisine != 'all') { // filter by cuisine\r\n                    results = results.filter(r => r.cuisine_type == cuisine);\r\n                }\r\n                if (neighborhood != 'all') { // filter by neighborhood\r\n                    results = results.filter(r => r.neighborhood == neighborhood);\r\n                }\r\n                callback(null, results);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Fetch all neighborhoods with proper error handling.\r\n     */\r\n    static fetchNeighborhoods(callback) {\r\n        // Fetch all restaurants\r\n        DBHelper.fetchRestaurants((error, restaurants) => {\r\n            if (error) {\r\n                callback(error, null);\r\n            } else {\r\n                // Get all neighborhoods from all restaurants\r\n                const neighborhoods = restaurants.map((v, i) => restaurants[i].neighborhood)\r\n                // Remove duplicates from neighborhoods\r\n                const uniqueNeighborhoods = neighborhoods.filter((v, i) => neighborhoods.indexOf(v) == i)\r\n                callback(null, uniqueNeighborhoods);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Fetch all cuisines with proper error handling.\r\n     */\r\n    static fetchCuisines(callback) {\r\n        // Fetch all restaurants\r\n        DBHelper.fetchRestaurants((error, restaurants) => {\r\n            if (error) {\r\n                callback(error, null);\r\n            } else {\r\n                // Get all cuisines from all restaurants\r\n                const cuisines = restaurants.map((v, i) => restaurants[i].cuisine_type)\r\n                // Remove duplicates from cuisines\r\n                const uniqueCuisines = cuisines.filter((v, i) => cuisines.indexOf(v) == i)\r\n                callback(null, uniqueCuisines);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Restaurant page URL.\r\n     */\r\n    static urlForRestaurant(restaurant) {\r\n        return (`./restaurant.html?id=${restaurant.id}`);\r\n    }\r\n\r\n    /**\r\n     * Restaurant image URL.\r\n     */\r\n    static imageUrlForRestaurant(restaurant) {\r\n        return (`/img/${restaurant.photograph}`);\r\n    }\r\n\r\n    /**\r\n     * Map marker for a restaurant.\r\n     */\r\n    static mapMarkerForRestaurant(restaurant, map) {\r\n        const marker = new google.maps.Marker({\r\n            position: restaurant.latlng,\r\n            title: restaurant.name,\r\n            url: DBHelper.urlForRestaurant(restaurant),\r\n            map: map,\r\n            animation: google.maps.Animation.DROP\r\n        });\r\n        return marker;\r\n    }\r\n\r\n}\r\n","let restaurants,\r\n    neighborhoods,\r\n    cuisines, map, markers = [];\r\n\r\n/**\r\n * Fetch neighborhoods and cuisines as soon as the page is loaded.\r\n */\r\ndocument.addEventListener('DOMContentLoaded', (event) => {\r\n\r\n    getAllRestaurants();\r\n    fetchNeighborhoods();\r\n    fetchCuisines();\r\n});\r\n\r\n/**\r\n * Fetch all neighborhoods and set their HTML.\r\n */\r\nconst fetchNeighborhoods = () => {\r\n    DBHelper.fetchNeighborhoods((error, neighborhoods) => {\r\n        if (error) { // Got an error\r\n            console.error(error);\r\n        } else {\r\n            self.neighborhoods = neighborhoods;\r\n            fillNeighborhoodsHTML();\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Set neighborhoods HTML.\r\n */\r\nconst fillNeighborhoodsHTML = (neighborhoods = self.neighborhoods) => {\r\n    const select = document.getElementById('neighborhoods-select');\r\n    neighborhoods.forEach(neighborhood => {\r\n        const option = document.createElement('option');\r\n        option.innerHTML = neighborhood;\r\n        option.value = neighborhood;\r\n        select.append(option);\r\n    });\r\n}\r\n\r\n/**\r\n * Fetch all cuisines and set their HTML.\r\n */\r\nconst fetchCuisines = () => {\r\n    DBHelper.fetchCuisines((error, cuisines) => {\r\n        if (error) { // Got an error!\r\n            console.error(error);\r\n        } else {\r\n            self.cuisines = cuisines;\r\n            fillCuisinesHTML();\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Set cuisines HTML.\r\n */\r\nconst fillCuisinesHTML = (cuisines = self.cuisines) => {\r\n    const select = document.getElementById('cuisines-select');\r\n\r\n    cuisines.forEach(cuisine => {\r\n        const option = document.createElement('option');\r\n        option.innerHTML = cuisine;\r\n        option.value = cuisine;\r\n        select.append(option);\r\n    });\r\n}\r\n\r\n/**\r\n * Initialize Google map, called from HTML.\r\n */\r\nfunction initMap() {\r\n    let loc = {\r\n        lat: 40.722216,\r\n        lng: -73.987501\r\n    };\r\n    if (!self.map) {\r\n        self.map = new google.maps.Map(document.getElementById('map'), {\r\n            zoom: 12,\r\n            center: loc,\r\n            scrollwheel: false\r\n        });\r\n    }\r\n\r\n    document.getElementById(\"map-container\").classList.add(\"show-interactive-map\");\r\n    //set markers on the map\r\n    addMarkersToMap();\r\n}\r\n\r\nconst initStaticMap = () => {\r\n    let latlng = \"40.722216,-73.987501\",\r\n        zoom = 12,\r\n        imageConrtainer = document.getElementById(\"map-container\");\r\n    let size = imageConrtainer.offsetWidth + \"x\" + imageConrtainer.offsetHeight;\r\n    let staticMapURL = `https://maps.googleapis.com/maps/api/staticmap?center=${latlng}&zoom=${zoom}&size=${size}&key=AIzaSyD7zwXocDxCO_YLSyVhDNYZDmhMxr0RcNU`;\r\n    restaurants.forEach((restaurant) => {\r\n        staticMapURL += `&markers=${restaurant.latlng.lat},${restaurant.latlng.lng}` ;\r\n    });\r\n    document.querySelector(\".static-map\").setAttribute(\"src\", staticMapURL);\r\n}\r\nconst getAllRestaurants = () => {\r\n    DBHelper.fetchRestaurantByCuisineAndNeighborhood(\"all\", \"all\", (error, restaurants) => {\r\n        if (error) { // Got an error!\r\n            console.error(error);\r\n        } else {\r\n            resetRestaurants(restaurants);\r\n            fillRestaurantsHTML();\r\n            initStaticMap();\r\n        }\r\n    })\r\n}\r\n/**\r\n * Update page and map for current restaurants.\r\n */\r\nconst updateRestaurants = () => {\r\n    const cSelect = document.getElementById('cuisines-select');\r\n    const nSelect = document.getElementById('neighborhoods-select');\r\n    //get slected option value\r\n    const cuisine = cSelect[cSelect.selectedIndex].value;\r\n    const neighborhood = nSelect[nSelect.selectedIndex].value;\r\n\r\n    DBHelper.fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood, (error, restaurants) => {\r\n        if (error) { // Got an error!\r\n            console.error(error);\r\n        } else {\r\n            resetRestaurants(restaurants);\r\n            fillRestaurantsHTML();\r\n            initMap();\r\n        }\r\n    })\r\n}\r\n\r\n/**\r\n * Clear current restaurants, their HTML and remove their map markers.\r\n */\r\nconst resetRestaurants = (restaurants) => {\r\n    // Remove all restaurants\r\n    self.restaurants = [];\r\n    const ul = document.getElementById('restaurants-list');\r\n    ul.innerHTML = '';\r\n\r\n    // Remove all map markers\r\n    self.markers.forEach(m => m.setMap(null));\r\n    self.markers = [];\r\n    self.restaurants = restaurants;\r\n}\r\n\r\n/**\r\n * Create all restaurants HTML and add them to the webpage.\r\n */\r\nconst fillRestaurantsHTML = (restaurants = self.restaurants) => {\r\n    const ul = document.getElementById('restaurants-list');\r\n    restaurants.forEach(restaurant => {\r\n        ul.append(createRestaurantHTML(restaurant));\r\n    });\r\n\r\n    //now we have to fill the static image first\r\n    //addMarkersToMap();\r\n    //init lazy loading\r\n    setTimeout(function () {\r\n        bLazy.revalidate();\r\n    }, 10);\r\n}\r\n\r\n/**\r\n * Create restaurant HTML.\r\n */\r\nconst createRestaurantHTML = (restaurant) => {\r\n    const li = document.createElement('li');\r\n    li.setAttribute(\"role\", \"listitem\")\r\n\r\n    const image = document.createElement('img');\r\n    const imageSrc = DBHelper.imageUrlForRestaurant(restaurant);\r\n    image.className = 'restaurant-img b-lazy';\r\n    image.src = \"/img/placeholder-image.png\";\r\n    image.setAttribute(\"data-src\", `${imageSrc}`);\r\n    image.setAttribute(\"data-srcset\", `/img/${restaurant.id}_300.jpg 300w,/img/${restaurant.id}.jpg 586w,/img/${restaurant.id}_800.jpg 800w`);\r\n    image.alt = restaurant.name;\r\n    const picture = document.createElement('picture');\r\n    picture.append(image);\r\n    li.append(picture);\r\n    const dataContainer = document.createElement('article');\r\n    li.append(dataContainer);\r\n    const name = document.createElement('a');\r\n    name.innerHTML = restaurant.name;\r\n    name.href = DBHelper.urlForRestaurant(restaurant);\r\n    dataContainer.append(name);\r\n\r\n    const neighborhood = document.createElement('p');\r\n    neighborhood.setAttribute(\"title\", \"Neighborhood\");\r\n    neighborhood.innerHTML = restaurant.neighborhood;\r\n    dataContainer.append(neighborhood);\r\n\r\n    const address = document.createElement('address');\r\n    address.innerHTML = restaurant.address;\r\n    dataContainer.append(address);\r\n\r\n    const more = document.createElement('a');\r\n    more.innerHTML = 'View Details';\r\n    more.classList.add(\"more\");\r\n    more.setAttribute(\"role\", \"button\");\r\n    more.href = DBHelper.urlForRestaurant(restaurant);\r\n    dataContainer.append(more)\r\n\r\n    return li\r\n}\r\n\r\n/**\r\n * Add markers for current restaurants to the map.\r\n */\r\nconst addMarkersToMap = (restaurants = self.restaurants) => {\r\n    restaurants.forEach(restaurant => {\r\n        // Add marker to the map\r\n        const marker = DBHelper.mapMarkerForRestaurant(restaurant, self.map);\r\n        google.maps.event.addListener(marker, 'click', () => {\r\n            window.location.href = marker.url\r\n        });\r\n        self.markers.push(marker);\r\n    });\r\n}\r\n\r\n/*change aria expanded value*/\r\nconst changeAriaValue = (that) => {\r\n    that.getAttribute(\"aria-expanded\") == \"true\" ? that.setAttribute(\"aria-expanded\", \"false\") : that.setAttribute(\"aria-expanded\", \"true\");\r\n}\r\n\r\n\r\n\r\nconst bLazy = new Blazy({\r\n    // Options\r\n});\r\n"]}